{"ast":null,"code":"// Chat.tsx\nimport{useEffect,useState}from'react';import{getOpponentNickname}from'./LeftBar';import{useUser}from'../context/UserContext';import{MessengerService}from'../api/MessengerService';import{useMessenger}from'../context/MessengerContext';import{jsxs as _jsxs,jsx as _jsx}from\"react/jsx-runtime\";const Chat=_ref=>{let{trigger}=_ref;const{user}=useUser();const{messages,setMessages,currentChat}=useMessenger();const[chatMessages,setChatMessages]=useState([]);const[message,setMessage]=useState('');const[opponentNickname,setOpponentNickname]=useState('');useEffect(()=>{if(!currentChat)return;function loadMessages(){if(!currentChat)return;const filteredMessages=messages.filter(msg=>msg.sender==getOpponentNickname(user,currentChat)||msg.receiver==getOpponentNickname(user,currentChat));setChatMessages(filteredMessages);}loadMessages();},[currentChat,trigger,messages]);const sendMessage=async()=>{if(!user||!currentChat)return;if(message.trim()){setMessage('');await MessengerService.sendMessage(getOpponentNickname(user,currentChat),message,String(currentChat.sharedSecretKey),user.jwt);}const messageToSave={sender:user.nickname,receiver:getOpponentNickname(user,currentChat),createdAt:new Date(),content:message};setMessages(prev=>[...prev,messageToSave]);};return/*#__PURE__*/_jsxs(\"section\",{style:{flex:1,padding:'10px'},children:[/*#__PURE__*/_jsxs(\"h3\",{children:[\"Chatting with \",opponentNickname,\" Secret: \",currentChat&&currentChat.sharedSecretKey.toString()]}),/*#__PURE__*/_jsx(\"div\",{style:{height:'300px',overflowY:'scroll',border:'1px solid #ccc',marginBottom:'10px',padding:'10px'},children:chatMessages.map((msg,index)=>/*#__PURE__*/_jsxs(\"p\",{children:[msg.sender,\": \",msg.content]},index))}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Type a message...\",value:message,onChange:e=>setMessage(e.target.value),onKeyDown:e=>e.key==='Enter'&&sendMessage(),style:{width:'80%',padding:'5px'}}),/*#__PURE__*/_jsx(\"button\",{onClick:sendMessage,style:{marginLeft:'5px'},children:\"Send\"})]});};export default Chat;","map":{"version":3,"names":["useEffect","useState","getOpponentNickname","useUser","MessengerService","useMessenger","jsxs","_jsxs","jsx","_jsx","Chat","_ref","trigger","user","messages","setMessages","currentChat","chatMessages","setChatMessages","message","setMessage","opponentNickname","setOpponentNickname","loadMessages","filteredMessages","filter","msg","sender","receiver","sendMessage","trim","String","sharedSecretKey","jwt","messageToSave","nickname","createdAt","Date","content","prev","style","flex","padding","children","toString","height","overflowY","border","marginBottom","map","index","type","placeholder","value","onChange","e","target","onKeyDown","key","width","onClick","marginLeft"],"sources":["/home/n/Desktop/temp/app/src/components/Chat.tsx"],"sourcesContent":["// Chat.tsx\nimport { JSXElementConstructor, Key, ReactElement, ReactNode, ReactPortal, useEffect, useState } from 'react';\nimport { getOpponentNickname } from './LeftBar';\nimport { useUser } from '../context/UserContext';\nimport { MessengerService } from '../api/MessengerService';\nimport { useMessenger } from '../context/MessengerContext';\nimport { Message } from '../types';\n\ninterface ChatProps {\n  trigger: number\n}\n\nconst Chat = ({ trigger }: ChatProps) => {\n  const { user } = useUser()\n  const {messages, setMessages, currentChat} = useMessenger()\n  const [chatMessages, setChatMessages] = useState<any>([])\n  const [message, setMessage] = useState('');\n  const [opponentNickname, setOpponentNickname] = useState<string>('')\n\n\n\n  useEffect(() => {\n    if (!currentChat) return\n    function loadMessages() {\n      if (!currentChat) return\n      const filteredMessages = messages.filter(msg => \n        msg.sender == getOpponentNickname(user, currentChat) || \n        msg.receiver == getOpponentNickname(user, currentChat)\n      );\n\n      setChatMessages(filteredMessages);\n    }\n\n    loadMessages()\n  }, [currentChat, trigger, messages])\n\n  const sendMessage = async () => {\n    if (!user || !currentChat) return\n    if (message.trim()) {\n      setMessage('');\n      await MessengerService.sendMessage(getOpponentNickname(user, currentChat), message, String(currentChat.sharedSecretKey), user.jwt)\n    }\n    const messageToSave: Message = \n    {\n      sender: user.nickname,\n      receiver: getOpponentNickname(user, currentChat),\n      createdAt: new Date(),\n      content: message\n    }\n    setMessages((prev)=> [...prev, messageToSave])\n\n  };\n\n  return (\n    <section style={{ flex: 1, padding: '10px' }}>\n      <h3>Chatting with {opponentNickname} Secret: {currentChat&& currentChat.sharedSecretKey.toString()}</h3>\n      <div style={{ height: '300px', overflowY: 'scroll', border: '1px solid #ccc', marginBottom: '10px', padding: '10px' }}>\n        {chatMessages.map((msg: { sender: string | number | boolean | ReactElement<any, string | JSXElementConstructor<any>> | Iterable<ReactNode> | ReactPortal | null | undefined; content: string | number | boolean | ReactElement<any, string | JSXElementConstructor<any>> | Iterable<ReactNode> | ReactPortal | null | undefined; }, index: Key | null | undefined) => (\n          <p key={index}>{msg.sender}: {msg.content}</p>\n        ))}\n      </div>\n      <input\n        type=\"text\"\n        placeholder=\"Type a message...\"\n        value={message}\n        onChange={e => setMessage(e.target.value)}\n        onKeyDown={e => e.key === 'Enter' && sendMessage()}\n        style={{ width: '80%', padding: '5px' }}\n      />\n      <button onClick={sendMessage} style={{ marginLeft: '5px' }}>Send</button>\n    </section>\n  );\n};\n\nexport default Chat;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}