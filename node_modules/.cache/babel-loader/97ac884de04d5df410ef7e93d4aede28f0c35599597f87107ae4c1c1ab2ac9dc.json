{"ast":null,"code":"var _jsxFileName = \"/home/n/Desktop/privchat10.11.2024/privchatFrontend/src/components/MessageInput.tsx\",\n  _s = $RefreshSig$();\nimport { useState } from 'react';\nimport { useMessenger } from '../context/MessengerContext';\nimport AnimatedButton from './Button';\nimport { getOpponentNickname } from '../utils/functions';\nimport { MessengerService } from '../api/MessengerService';\nimport { useUser } from '../context/UserContext';\nimport { iconsRef } from '../utils/iconsRef';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst MessageInput = ({\n  updateMessages\n}) => {\n  _s();\n  const [message, setMessage] = useState('');\n  const [selectedFile, setSelectedFile] = useState(null);\n  const {\n    user\n  } = useUser();\n  const {\n    messages,\n    setMessages,\n    chatWidth,\n    currentChat\n  } = useMessenger();\n  async function sendMessage() {\n    if (!user || !currentChat) return;\n    if (!selectedFile && message.trim()) {\n      setMessage('');\n      await MessengerService.sendMessage(getOpponentNickname(user, currentChat), message, String(currentChat.sharedSecretKey), user.jwt);\n    } else if (selectedFile) {\n      // Upload the selected file\n      await MessengerService.uploadEncryptedFile(selectedFile, String(currentChat.sharedSecretKey), user.jwt, getOpponentNickname(user, currentChat));\n      console.log('File uploaded:', selectedFile.name);\n      setSelectedFile(null);\n    }\n    const messageToSave = {\n      sender: user.nickname,\n      receiver: getOpponentNickname(user, currentChat),\n      time: String(new Date()),\n      content: selectedFile ? `File: ${selectedFile.name}` : message\n    };\n    setMessages(prev => [...prev, messageToSave]);\n  }\n  function handleFileSelect() {\n    if (!user || !currentChat) return;\n    const input = document.createElement('input');\n    input.type = 'file';\n    input.onchange = event => {\n      const target = event.target;\n      if (target.files && target.files[0]) {\n        setSelectedFile(target.files[0]);\n        console.log('Selected file:', target.files[0]);\n        setMessage(''); // Clear the message input when a file is selected\n      }\n    };\n    input.click();\n  }\n  function clearSelectedFile() {\n    setSelectedFile(null);\n    setMessage('');\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"flex items-center p-4 h-[100px] absolute bottom-0 justify-center\",\n    style: {\n      width: chatWidth,\n      zIndex: 500\n    },\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex\",\n      style: {\n        width: chatWidth * 0.7\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex flex-row p-2 border border-[#4f4f4f] bg-white rounded mr-2 bg-transparent w-full relative\",\n        children: [selectedFile ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex flex-row items-center w-full text-black px-2\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"truncate\",\n            children: [selectedFile.name, \" (\", (selectedFile.size / 1024).toFixed(2), \" KB)\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 77,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: clearSelectedFile,\n            className: \"ml-2 text-red-500 hover:text-red-700\",\n            style: {\n              cursor: 'pointer'\n            },\n            children: \"\\u2715\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 80,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 76,\n          columnNumber: 13\n        }, this) : /*#__PURE__*/_jsxDEV(\"input\", {\n          className: \"w-full text-black focus:outline-none focus:ring-0\",\n          type: \"text\",\n          placeholder: \"Type your message...\",\n          value: message,\n          onChange: e => setMessage(e.target.value),\n          disabled: !!selectedFile // Disable input when a file is selected\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 89,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex flex-row gap-2 max-h-[40px] pl-2\",\n          children: [/*#__PURE__*/_jsxDEV(Icon, {\n            icon: iconsRef.photo,\n            onClick: handleFileSelect\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 99,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Icon, {\n            icon: iconsRef.clip,\n            w: 35,\n            h: 35,\n            onClick: handleFileSelect\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 100,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 98,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 74,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(AnimatedButton, {\n        text: 'Send',\n        onClick: sendMessage\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 104,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 73,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 69,\n    columnNumber: 5\n  }, this);\n};\n_s(MessageInput, \"wOqH2bZcx1GpA2OzL02EmC227Ho=\", false, function () {\n  return [useUser, useMessenger];\n});\n_c = MessageInput;\nconst Icon = ({\n  icon,\n  onClick,\n  w = 30,\n  h = 30\n}) => {\n  return /*#__PURE__*/_jsxDEV(\"img\", {\n    src: icon,\n    width: w,\n    height: h,\n    onClick: onClick,\n    style: {\n      cursor: 'pointer'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 122,\n    columnNumber: 5\n  }, this);\n};\n_c2 = Icon;\nexport default MessageInput;\nvar _c, _c2;\n$RefreshReg$(_c, \"MessageInput\");\n$RefreshReg$(_c2, \"Icon\");","map":{"version":3,"names":["useState","useMessenger","AnimatedButton","getOpponentNickname","MessengerService","useUser","iconsRef","jsxDEV","_jsxDEV","MessageInput","updateMessages","_s","message","setMessage","selectedFile","setSelectedFile","user","messages","setMessages","chatWidth","currentChat","sendMessage","trim","String","sharedSecretKey","jwt","uploadEncryptedFile","console","log","name","messageToSave","sender","nickname","receiver","time","Date","content","prev","handleFileSelect","input","document","createElement","type","onchange","event","target","files","click","clearSelectedFile","className","style","width","zIndex","children","size","toFixed","fileName","_jsxFileName","lineNumber","columnNumber","onClick","cursor","placeholder","value","onChange","e","disabled","Icon","icon","photo","clip","w","h","text","_c","src","height","_c2","$RefreshReg$"],"sources":["/home/n/Desktop/privchat10.11.2024/privchatFrontend/src/components/MessageInput.tsx"],"sourcesContent":["import { useContext, useState } from 'react';\nimport { useMessenger } from '../context/MessengerContext';\nimport AnimatedButton from './Button';\nimport { getOpponentNickname } from '../utils/functions';\nimport { MessengerService } from '../api/MessengerService';\nimport { MessageInterface } from '../types';\nimport { useUser } from '../context/UserContext';\nimport { iconsRef } from '../utils/iconsRef';\n\nconst MessageInput = ({ updateMessages }: any) => {\n  const [message, setMessage] = useState('');\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\n  const { user } = useUser();\n  const { messages, setMessages, chatWidth, currentChat } = useMessenger();\n\n  async function sendMessage() {\n    if (!user || !currentChat) return;\n    if (!selectedFile && message.trim()) {\n      setMessage('');\n      await MessengerService.sendMessage(\n        getOpponentNickname(user, currentChat),\n        message,\n        String(currentChat.sharedSecretKey),\n        user.jwt\n      );\n    } else if (selectedFile) {\n      // Upload the selected file\n      await MessengerService.uploadEncryptedFile(\n        selectedFile,\n        String(currentChat.sharedSecretKey),\n        user.jwt,\n        getOpponentNickname(user, currentChat)\n      );\n      console.log('File uploaded:', selectedFile.name);\n      setSelectedFile(null);\n    }\n\n    const messageToSave: MessageInterface = {\n      sender: user.nickname,\n      receiver: getOpponentNickname(user, currentChat),\n      time: String(new Date()),\n      content: selectedFile ? `File: ${selectedFile.name}` : message,\n    };\n    setMessages((prev) => [...prev, messageToSave]);\n  }\n\n  function handleFileSelect() {\n    if (!user || !currentChat) return;\n\n    const input = document.createElement('input');\n    input.type = 'file';\n    input.onchange = (event: Event) => {\n      const target = event.target as HTMLInputElement;\n      if (target.files && target.files[0]) {\n        setSelectedFile(target.files[0]);\n        console.log('Selected file:', target.files[0]);\n        setMessage(''); // Clear the message input when a file is selected\n      }\n    };\n    input.click();\n  }\n\n  function clearSelectedFile() {\n    setSelectedFile(null);\n    setMessage('');\n  }\n\n  return (\n    <div\n      className=\"flex items-center p-4 h-[100px] absolute bottom-0 justify-center\"\n      style={{ width: chatWidth, zIndex: 500 }}\n    >\n      <div className=\"flex\" style={{ width: chatWidth * 0.7 }}>\n        <div className=\"flex flex-row p-2 border border-[#4f4f4f] bg-white rounded mr-2 bg-transparent w-full relative\">\n          {selectedFile ? (\n            <div className=\"flex flex-row items-center w-full text-black px-2\">\n              <span className=\"truncate\">\n                {selectedFile.name} ({(selectedFile.size / 1024).toFixed(2)} KB)\n              </span>\n              <button\n                onClick={clearSelectedFile}\n                className=\"ml-2 text-red-500 hover:text-red-700\"\n                style={{ cursor: 'pointer' }}\n              >\n                âœ•\n              </button>\n            </div>\n          ) : (\n            <input\n              className=\"w-full text-black focus:outline-none focus:ring-0\"\n              type=\"text\"\n              placeholder=\"Type your message...\"\n              value={message}\n              onChange={(e) => setMessage(e.target.value)}\n              disabled={!!selectedFile} // Disable input when a file is selected\n            />\n          )}\n          <div className=\"flex flex-row gap-2 max-h-[40px] pl-2\">\n            <Icon icon={iconsRef.photo} onClick={handleFileSelect} />\n            <Icon icon={iconsRef.clip} w={35} h={35} onClick={handleFileSelect} />\n          </div>\n        </div>\n\n        <AnimatedButton text={'Send'} onClick={sendMessage} />\n      </div>\n    </div>\n  );\n};\n\nconst Icon = ({\n  icon,\n  onClick,\n  w = 30,\n  h = 30,\n}: {\n  icon: string;\n  onClick: () => void;\n  w?: number;\n  h?: number;\n}) => {\n  return (\n    <img\n      src={icon}\n      width={w}\n      height={h}\n      onClick={onClick}\n      style={{ cursor: 'pointer' }}\n    />\n  );\n};\n\nexport default MessageInput;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}