{"ast":null,"code":"import axios from \"axios\";\nimport DiffieHellmanService from \"./DiffieHellmanService\";\nimport { IP } from \"../types\";\nconst BASE_URL = `http://${IP}`;\nexport const MessengerService = {\n  async getMessages(jwt) {\n    const response = await axios.get(`${BASE_URL}/encrypt-chat/messages`, {\n      headers: {\n        Authorization: `Bearer ${jwt}`\n      }\n    });\n    return response.data;\n  },\n  async sendMessage(receiver, content, secretKey, jwt) {\n    const encryptedContent = DiffieHellmanService.encrypt(content, secretKey);\n    const dto = {\n      content: encryptedContent,\n      receiver: receiver\n    };\n    const response = await axios.post(`${BASE_URL}/encrypt-chat/messages`, dto, {\n      headers: {\n        Authorization: `Bearer ${jwt}`\n      }\n    });\n    return response.data;\n  },\n  async getMessagesFromUser(nickname, secretKey, jwt) {\n    const response = await axios.get(`${BASE_URL}/encrypt-chat/messages-from`, {\n      params: {\n        nickname\n      },\n      headers: {\n        Authorization: `Bearer ${jwt}`\n      }\n    });\n    return DiffieHellmanService.decryptMessages(response.data, secretKey);\n  },\n  async getChats(requestedPublicKey, jwt) {\n    try {\n      const response = await axios.post(`${BASE_URL}/encrypt-chat/process`, requestedPublicKey, {\n        headers: {\n          Authorization: `Bearer ${jwt}`,\n          \"Content-Type\": \"text/plain\"\n        }\n      });\n      console.log(response);\n      return response.data;\n    } catch (error) {\n      if (axios.isAxiosError(error) && error.response) {\n        if (error.response.status === 404) {\n          console.log(\"Request does not exist\");\n          return \"not found\";\n        }\n      }\n      console.log('Error:', error);\n      return \"error\";\n    }\n  },\n  async sendChatRequest(dto, jwt) {\n    try {\n      const response = await axios.post(`${BASE_URL}/encrypt-chat/create`, dto, {\n        headers: {\n          Authorization: `Bearer ${jwt}`\n        }\n      });\n      if (response.status == 200) {\n        console.log(\"Chat request sent successfully!\");\n      } else {\n        console.log(\"Chat request was not send\");\n      }\n      return \"success\";\n    } catch (error) {\n      if (axios.isAxiosError(error) && error.response) {\n        if (error.response.status === 409) {\n          console.log(\"Request already exists\");\n          return \"duplicate\";\n        }\n      }\n      console.log('Error:', error);\n      return \"error\";\n    }\n  },\n  // Upload Encrypted File\n  async uploadEncryptedFile(file, secretKey, jwt, sender) {\n    try {\n      // Encrypt the file content\n      const encryptedFile = await DiffieHellmanService.encryptFile(file, secretKey);\n      const formData = new FormData();\n      formData.append(\"file\", encryptedFile);\n      const response = await axios.post(`${BASE_URL}/encrypt-files/files`, formData, {\n        headers: {\n          Authorization: `Bearer ${jwt}`,\n          \"Content-Type\": \"multipart/form-data\"\n        }\n      });\n      console.log(\"Encrypted file uploaded successfully!\");\n      return response.data;\n    } catch (error) {\n      console.error(\"Error uploading encrypted file:\", error);\n      throw error;\n    }\n  },\n  // Retrieve Encrypted File\n  async downloadEncryptedFile(fileId, secretKey, jwt) {\n    try {\n      const response = await axios.get(`${BASE_URL}/encrypt-files/files/${fileId}`, {\n        headers: {\n          Authorization: `Bearer ${jwt}`\n        },\n        responseType: \"blob\" // To handle binary file data\n      });\n      const encryptedBlob = new Blob([response.data]);\n      const encryptedFile = new File([encryptedBlob], `encrypted_${fileId}.enc`);\n\n      // Decrypt the file\n      const decryptedFile = await DiffieHellmanService.decryptFile(encryptedFile, secretKey);\n      console.log(\"Encrypted file downloaded and decrypted successfully!\");\n      return decryptedFile;\n    } catch (error) {\n      console.error(\"Error downloading or decrypting file:\", error);\n      throw error;\n    }\n  }\n};","map":{"version":3,"names":["axios","DiffieHellmanService","IP","BASE_URL","MessengerService","getMessages","jwt","response","get","headers","Authorization","data","sendMessage","receiver","content","secretKey","encryptedContent","encrypt","dto","post","getMessagesFromUser","nickname","params","decryptMessages","getChats","requestedPublicKey","console","log","error","isAxiosError","status","sendChatRequest","uploadEncryptedFile","file","sender","encryptedFile","encryptFile","formData","FormData","append","downloadEncryptedFile","fileId","responseType","encryptedBlob","Blob","File","decryptedFile","decryptFile"],"sources":["/home/n/Desktop/privchat10.11.2024/privchatFrontend/src/api/MessengerService.ts"],"sourcesContent":["import axios from \"axios\";\nimport DiffieHellmanService from \"./DiffieHellmanService\";\nimport { ChatRequestDto, IP } from \"../types\";\n\nconst BASE_URL = `http://${IP}`;\n\n\nexport const MessengerService = {\n  async getMessages(jwt: string) {\n    const response = await axios.get(`${BASE_URL}/encrypt-chat/messages`, {\n      headers: { Authorization: `Bearer ${jwt}` }\n    });\n    return response.data;\n  },\n\n  async sendMessage(receiver: string, content: string, secretKey: string, jwt: string) {\n    const encryptedContent = DiffieHellmanService.encrypt(content, secretKey)\n    const dto = { content: encryptedContent, receiver: receiver }\n\n    const response = await axios.post(`${BASE_URL}/encrypt-chat/messages`, dto, {\n      headers: { Authorization: `Bearer ${jwt}` }\n    });\n\n    return response.data;\n  },\n\n  async getMessagesFromUser(nickname: string, secretKey: string, jwt: string) {\n\n    const response = await axios.get(`${BASE_URL}/encrypt-chat/messages-from`, {\n      params: { nickname },\n      headers: { Authorization: `Bearer ${jwt}` }\n    });\n\n    return DiffieHellmanService.decryptMessages(response.data, secretKey)\n  },\n\n  async getChats(requestedPublicKey: string, jwt: string) {\n    try {\n      const response = await axios.post(\n        `${BASE_URL}/encrypt-chat/process`,\n        requestedPublicKey,\n        {\n          headers: {\n            Authorization: `Bearer ${jwt}`,\n            \"Content-Type\": \"text/plain\",\n          },\n        }\n      );\n      console.log(response)\n\n      return response.data;\n\n    } catch (error) {\n      if (axios.isAxiosError(error) && error.response) {\n        if (error.response.status === 404) {\n          console.log(\"Request does not exist\");\n          return \"not found\";\n        }\n      }\n      console.log('Error:', error);\n      return \"error\";\n    }\n  },\n\n  async sendChatRequest(dto: ChatRequestDto, jwt: string) {\n\n    try {\n      const response = await axios.post(\n        `${BASE_URL}/encrypt-chat/create`,\n        dto,\n        {\n          headers: {\n            Authorization: `Bearer ${jwt}`\n          }\n        }\n      );\n      if (response.status == 200) {\n        console.log(\"Chat request sent successfully!\");\n\n      } else {\n        console.log(\"Chat request was not send\")\n      }\n      return \"success\";\n\n    } catch (error) {\n      if (axios.isAxiosError(error) && error.response) {\n        if (error.response.status === 409) {\n          console.log(\"Request already exists\");\n          return \"duplicate\";\n        }\n      }\n      console.log('Error:', error);\n      return \"error\";\n    }\n  },\n\n  // Upload Encrypted File\n  async uploadEncryptedFile(file: File, secretKey: string, jwt: string, sender: strin) {\n    try {\n      // Encrypt the file content\n      const encryptedFile = await DiffieHellmanService.encryptFile(file, secretKey);\n\n      const formData = new FormData();\n      formData.append(\"file\", encryptedFile);\n\n      const response = await axios.post(`${BASE_URL}/encrypt-files/files`, formData, {\n        headers: {\n          Authorization: `Bearer ${jwt}`,\n          \"Content-Type\": \"multipart/form-data\",\n        },\n      });\n\n      console.log(\"Encrypted file uploaded successfully!\");\n      return response.data;\n    } catch (error) {\n      console.error(\"Error uploading encrypted file:\", error);\n      throw error;\n    }\n  },\n\n  // Retrieve Encrypted File\n  async downloadEncryptedFile(fileId: string, secretKey: string, jwt: string): Promise<File> {\n    try {\n      const response = await axios.get(`${BASE_URL}/encrypt-files/files/${fileId}`, {\n        headers: {\n          Authorization: `Bearer ${jwt}`,\n        },\n        responseType: \"blob\", // To handle binary file data\n      });\n\n      const encryptedBlob = new Blob([response.data]);\n      const encryptedFile = new File([encryptedBlob], `encrypted_${fileId}.enc`);\n\n      // Decrypt the file\n      const decryptedFile = await DiffieHellmanService.decryptFile(encryptedFile, secretKey);\n\n      console.log(\"Encrypted file downloaded and decrypted successfully!\");\n      return decryptedFile;\n    } catch (error) {\n      console.error(\"Error downloading or decrypting file:\", error);\n      throw error;\n    }\n  },\n\n};\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}